{"basic_builder": {"appname": "TA-microsoft-public-ip-generic", "friendly_name": "Microsoft public ip generic", "version": "1.0.4", "author": "Vignesh Narendran", "description": "This information is typically used for threat detection.\n\nThis app is capable of downloading file from Microsoft site and index them splitting into events.\nWebsite format: https://www.microsoft.com/en-us/download/details.aspx?id=", "theme": "#65A637", "large_icon": "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", "small_icon": "iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAAXNSR0IArs4c6QAAA/VJREFUWEftmM1rXFUUwH/3vnmJJk0m1iIqNV0Y3dSmiLjSYSa0ya4Iku4MXfoXqBXxf7CKLoxVW0QQVAwVBYvoxkzTggra7lyUtlEaQZuZybz35r175N735iPNRPIgpbPoZRbv6977O1/3nDkqaDVEi0ZUgpYCCk2eIYCWhER7iDIoVGe6iKDcbfdZ+2X6ToFdQBn3jUGjwnBDWr8u4928ls2zk+1X7YV6r+0zt4J7KwgtEfxnKsQT9/H7zS9RJN332wIJIqRA2T57/EeYevAoKq7X5NY7r6AvnncfKAST0ds7I5YetNIOoCOZBRIhFMPIGx/RmNrDuyszeLrVA5RK3t043d7Os+IoZa0hIB6T4yWOT3+MajXWpXHqVfSl71Dac7IbYyw+WlkgO0HQWruFHJBOzSrGkCTC0Jun+efJURarM1AIuxa/Xbkde93uFJoD42WOT59FtTbWpfHWa3gOKNvISZCqNJVm67V9ZmHjxDBsgZ4Y4YPlI+D3AO3EGa28qAzozGagbOedLJP5ELsKND99D6iP8tsmK5aZf2qQNNQXqHMu7MyNrLvvmlP3A7JRZiPLhb09e7TedN0J+wx8V6Ns4Ew2Xmbwo2zwTDYYTn3LpQ596XwnwW8tFvpH3eYoG2XRpY5gZyHa/sqmTRSTxQrzh86gmo11Cd57He/nH0C0y/Z5RpTA0Mm3qU2NcHrlBfCCnCsIojQHxkq8eHARFQZN2fjlR1i7BlLoW0z9H2BMxMizs0TFUa78+QWofAJZ/Vg1jA3t4/GHZlH1MJLqXw2uNrV7kWu4siai8uj97Pf/Jl77Hs9Vf3mGzR0K4z9MYe9zqFoQycsX1/l6NSs+JR+UlpBPS2McHb+MWTmGVlEusdLqRhFPPI9/6H1UPYhkoVpjabWtbdWvBN5WZJ20+KoyylzxMmZ5Bk+1cgLZOhSSB8r4hz+xQKEsVOuDBBRkQBrl9HfXNdQLlFkmhxvdAZPdA9oUIK6k2ezUA6ehUBYu1Fm6kZ6Y9rfdX5/e51ZMe38HfGjggAbOZIEsXGg4k3Xy4l0N+zCUl+xJnQFt0z3pmzpcKyZusTRjU8cVzHIZjzhf6nAtjJ7UUWuGcqJa49z1AnG+1pCDHIojzs34VMavEq+U8GjmSfXpvxtTIN5bonD4LOrfoCknfqrxzXXXsEFJt0TrZ7lud8hVDfhJxGdHisyN/UayPIuPbcfsfNg1bJvLTJTwn/4QtRFG8u2NOn/UPdf9cE0tk8H19q7cHu1GU1oy2HudCMcmPfYPr6FWP8fL4X9tbMGQDD+G3jeHasWxJNlpmVa3PWML0FbJrcYK1gvsESbWf/IRpfWlcS0ZRYH/AKPJUXN/RKlNAAAAAElFTkSuQmCC", "visible": true, "tab_version": "4.1.3", "tab_build_no": "0", "build_no": 5}, "data_input_builder": {"datainputs": [{"index": "default", "sourcetype": "info:public:ip", "interval": "6000", "use_external_validation": true, "streaming_mode_xml": true, "name": "microsoft_public_ip", "title": "microsoft_public_ip", "description": "", "type": "customized", "parameters": [{"name": "download_url_id", "label": "Download URL ID", "help_string": "https://www.microsoft.com/en-us/download/confirmation.aspx?id=", "required": true, "format_type": "text", "default_value": "", "placeholder": "ID=", "type": "text", "value": "53602"}, {"name": "file_format", "label": "File format", "help_string": "RAW - for any other file types ||||||||||||||||||||\nCSV - assumes the file will have header row", "required": true, "possible_values": [{"value": "json", "label": "JSON"}, {"value": "csv", "label": "CSV"}, {"value": "raw", "label": "RAW"}], "format_type": "dropdownlist", "default_value": "", "placeholder": "", "type": "dropdownlist", "value": "csv"}, {"name": "url_region", "label": "URL region", "help_string": "", "required": true, "possible_values": [{"value": "in", "label": "IN"}, {"value": "us", "label": "US"}], "format_type": "dropdownlist", "default_value": "in", "placeholder": "", "type": "dropdownlist", "value": "in"}], "data_inputs_options": [{"type": "customized_var", "name": "download_url_id", "title": "Download URL ID", "description": "https://www.microsoft.com/en-us/download/confirmation.aspx?id=", "required_on_edit": false, "required_on_create": true, "format_type": "text", "default_value": "", "placeholder": "ID="}, {"type": "customized_var", "name": "file_format", "title": "File format", "description": "RAW - for any other file types ||||||||||||||||||||\nCSV - assumes the file will have header row", "required_on_edit": false, "required_on_create": true, "possible_values": [{"value": "json", "label": "JSON"}, {"value": "csv", "label": "CSV"}, {"value": "raw", "label": "RAW"}], "format_type": "dropdownlist", "default_value": "", "placeholder": ""}, {"type": "customized_var", "name": "url_region", "title": "URL region", "description": "", "required_on_edit": false, "required_on_create": true, "possible_values": [{"value": "in", "label": "IN"}, {"value": "us", "label": "US"}], "format_type": "dropdownlist", "default_value": "in", "placeholder": ""}], "code": "# encoding = utf-8\n\nimport os\nimport sys\nimport time\nimport datetime\nfrom lxml import html\nimport json\nimport csv\n\ndef validate_input(helper, definition):\n    pass\n\n\ndef get_download_link(helper,url):\n\n    headers = {\n        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36'\n    }\n    \n    try:\n        response = helper.send_http_request(url, \"GET\", headers=headers, timeout=120, verify=False)\n        response.raise_for_status()\n        tree = html.fromstring(response.content)\n        element = tree.xpath('//a[@data-bi-id=\"downloadretry\"]')\n        deep_link = element[0].attrib[\"href\"]\n        helper.log_debug(\"deeplink : {}\".format(deep_link))\n\n    except Exception as e:\n        helper.log_error(\"Exception on getting deep_link : {}\".format(e))\n        os._exit(1)\n\n    return deep_link\n\ndef index_events(helper,ew,item):\n\n    # get and set the meta values for each event\n    index=helper.get_arg('index')\n    input_name = helper.get_input_stanza_names()\n    sourcetype = helper.get_sourcetype()\n    source = \"microsoft://{}\".format(input_name).lower()\n    host = 'localhost'\n    # helper.log_debug(items)\n\n    helper.log_debug(\"Indexing item {}\".format(item))\n    event=helper.new_event(\n        item,\n        time=datetime.datetime.now(),\n        host=host,\n        index=index,\n        source=source,\n        sourcetype=sourcetype,\n        done=True,\n        unbroken=True\n    )\n    ew.write_event(event)\n    return\n\ndef index_json(helper,ew,response):\n    index_counter=0\n    helper.log_debug(\"JSON : {} \".format(response.text))\n    obj = response.json()\n    items = obj.get(\"values\",[])\n    for i in items:\n        index_counter+=1\n        text=json.dumps(i)\n        index_events(helper,ew,text)\n    return\n\ndef index_csv(helper,ew,response):\n    helper.log_debug(\"CSV to JSON : {} \".format(response.text))\n    index_counter=0\n    csv=response.text\n    rows = csv.split('\\n')\n    fieldnames = rows[0].split(',')\n    json_data = []\n    for row in rows [1:(len(rows)-1)]:\n        data = {}\n        for i, value in enumerate(row.split(',')):\n            data[fieldnames[i].strip()]=value.strip()\n            index_counter+=1\n            helper.log_debug(\"fieldname :\\\"{}\\\": \\\"value : \\\"{}\\\"\".format(fieldnames[i].strip(),value.strip()))\n\n        helper.log_debug(\"csv_json_converted_event: {}\".format(data))\n        index_events(helper,ew,\"{}\".format(json.dumps(data)))\n    return\n\n\n\ndef download_data(helper,deep_link):\n    try:\n        helper.log_info(\"Download file initiated : {}\".format(deep_link))\n        response = helper.send_http_request(deep_link, \"GET\", timeout=200,verify=False)\n    \n    except Exception as e:\n        helper.log_error(\"Exception while downloading : {}\".format(e))\n        os._exit(1)\n    return response\n    \ndef collect_events(helper, ew):\n\n    # init values\n    url=\"https://www.microsoft.com/en-{}/download/confirmation.aspx?id={}\".format(helper.get_arg('url_region'),helper.get_arg('download_url_id'))\n\n    deep_link=get_download_link(helper,url)\n    response=download_data(helper,deep_link)\n    try:\n        file_format_local=helper.get_arg('file_format')\n\n        if file_format_local.lower() == 'json':\n            count=index_json(helper,ew,response)\n        elif file_format_local.lower() == 'csv':\n            count=index_csv(helper,ew,response)\n        else:\n            count=index_events(helper,ew,response.text)\n        \n        helper.log_info(\"Indexed {} events into index={} sourcetype={} source={}\".format(count,helper.get_arg('index'),helper.get_sourcetype(),\"Microsoft://{}\".format(helper.get_input_stanza_names())))\n                \n    except Exception as e:\n        helper.log_error(\"Exception while indexing : {}\".format(e))\n        os._exit(1)\n", "customized_options": [{"name": "download_url_id", "value": "53602"}, {"name": "file_format", "value": "csv"}, {"name": "url_region", "value": "in"}], "uuid": "dc9b4f7fb4074fcf868a1ba6f846878f", "sample_count": "185592"}]}, "field_extraction_builder": {"info:public:ip": {"is_parsed": true, "data_format": "json"}}, "global_settings_builder": {"global_settings": {"proxy_settings": {"proxy_type": "http"}, "log_settings": {"log_level": "DEBUG"}}}, "sourcetype_builder": {"info:public:ip": {"metadata": {"event_count": 0, "data_input_name": "microsoft_public_ip", "extractions_count": 0, "cims_count": 0}}}, "validation": {"validators": ["best_practice_validation", "data_model_mapping_validation", "field_extract_validation", "app_cert_validation"], "status": "job_finished", "validation_id": "v_1684347626_63", "progress": 1.0}}